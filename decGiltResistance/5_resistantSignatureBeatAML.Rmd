---
title: "Fig 4 BeatAML Analysis"
author: "Sara Gosline"
date: "2024-08-07"
output: html_document
---

# Figure 4 generation

Here we use the proteomics measurements to derive a signature of resistance and apply it to BeatAML samples and evaluate drug response.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(tidyr)
library(readr)
library(dplyr)
library(pheatmap)
library(synapser)
synLogin()
```

## Load differential expression analysis

Here we want to load the proteomics and phospho data again

```{r data, warning=FALSE, message=FALSE}

##all metdata here
conds<-c("Decitabine Resistant","Early Gilteritinib Resistant","Late Gilteritinib Resistant","Early Gilteritinib/Decitabine Resistant","Late Gilteritinib/Decitabine Resistant",'Parental')
names(conds)=c('D_only','G_Early','G_Late','GD_Early','GD_Late','Parental')
##let's pick some standard colors for the conditions to use throughout the paper

phlist<-c(D_only='syn62012747',GD_Early='syn62012750',GD_Late='syn62012751',G_Early='syn62012748',G_Late='syn62012749')
phospho<-do.call(rbind,lapply(names(phlist),function(x){
  readr::read_csv(synGet(phlist[[x]])$path)|>
#  readr::read_csv(paste0('diff_ex_phospho_',x,'-none_Parental.csv'))|>
    mutate(condition=x)
}))

plist<-c(D_only='syn62012752',GD_Early='syn62012755',GD_Late='syn62012756',G_Early='syn62012753',G_Late='syn62012754')
prot<-do.call(rbind,lapply(names(plist),function(x){
  readr::read_csv(synGet(plist[[x]])$path)|>
    mutate(condition=x)
}))


##all metdata here
conds<-c("Decitabine Resistant","Early Gilteritinib Resistant","Late Gilteritinib Resistant","Early Gilteritinib/Decitabine Resistant","Late Gilteritinib/Decitabine Resistant",'Parental')
names(conds)=c('D_only','G_Early','G_Late','GD_Early','GD_Late','Parental')

##condition specific color scheme
colc<-c('#B75E5C','#E66100','#FFC20A','#0C7BDC','#44AA99','#AAAAAA')
names(colc)<-conds

#drug specific color scheme
dcolc<-colc[c(1,3,5,6)]
names(dcolc)=c('Decitabine','Gilteritinib','Gilteritinib/Decitabine','Parental')

```

## Signature creation
For each condition, determine a signature of proteins that are up- and down-regulated.Visualize those signatures and show how they segregate the cell lines.

```{r sigs, message=FALSE,warning=FALSE}

#for each condition, generate a signature of proteins and weights

#visualize that using heatmaps?

```

## BeatAML analysis

Now apply the signatures to each of the BeatAML samples to determine their status according to the cell lines.

```{r beatAML, message=FALSE,warning=FALSE}

ba_prot<-readr::read_tsv(synapser::synGet('syn25714248')$path)
ba_phos<-readr::read_tsv(synapser::synGet('syn32528196')$path)

##plot the patients samples by their predicted drug sensitivity

##score each patient based on resistant signature
drug_data<-synapser::synTableQuery('select * from syn25830473')$asDataFrame()

##we can expand this list, but at least let's focus on the drugs that we are predicting resistnace too as well as other targets
drugs_of_interest<-c("Azacytidine","Azacytidine - Quizartinib","Gilteritinib","Quizartinib (AC220)","p38 MAP Kinase Inhibitor","Cytarabine")

##plot the AUCs of the samples according to their predicted sensitivity

```



Now we can look at the drug response for each of those samples

```{r drug response}

```


